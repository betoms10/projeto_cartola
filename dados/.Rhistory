select( -rodada_id )
precos_jogadores %<>%
select( preco_num,
variacao_num,
preco_num_anterior )
precos_jogadores
informacoes_jogadores %<>%
right_join(., x = label_posicoes, by = "posicao_id" ) %>%
right_join(., x = label_status, by = "status_id" ) %>%
right_join(., x = label_clubes, by = "clube_id" ) %>%
bind_cols(., precos_jogadores ) %>%
bind_cols(., scouts_jogadores ) %>%
mutate( ano = year(Sys.Date()),
jogos_num = NA ) %>%
select( -classificacao, -slug ) %>%
as_data_frame()
informacoes_jogadores
informacoes_jogadores
write_csv( informacoes_jogadores,
path = paste0( 'data/scouts/', year( Sys.Date() ), '_scouts_', informacoes_jogadores$rodada_id[1], '.csv' ) )
write_csv( informacoes_jogadores,
path = paste0( 'data/scouts/', year( Sys.Date() ), '_scouts_', 0, '.csv' ) )
library(ProjectTemplate)
setwd('atual/')
load.project()
info( logger, "CARTOLA_DADOS::iniciado" )
info( logger, "CARTOLA_DADOS::obtem dados do mercado" )
dados_mercado <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/atletas/mercado" ),
collapse = "" )
)
dados_mercado
dados_partidas <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/partidas" ),
collapse = "" )
)
dados_partidas
informacoes_jogadores <- dados_mercado$atletas[1:13] %>%
as_data_frame %>%
select( -foto,
-nome,
-preco_num,
-variacao_num )
informacoes_jogadores
dados_partidas_anterior
rm(list=ls())
library(ProjectTemplate)
setwd('atual/')
load.project()
info( logger, "CARTOLA_DADOS::iniciado" )
info( logger, "CARTOLA_DADOS::obtem dados do mercado" )
dados_mercado <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/atletas/mercado" ),
collapse = "" )
)
dados_partidas <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/partidas" ),
collapse = "" )
)
rodada_anterior <- dados_partidas$rodada - 1
rodada_anterior
dados_partidas$rodada
dados_partidas_anterior <- fromJSON(
paste(
readLines( paste0( "https://api.cartolafc.globo.com/partidas/", rodada_anterior ) ),
collapse = "" )
)
rm(rodada_anterior)
informacoes_jogadores <- dados_mercado$atletas[1:13] %>%
as_data_frame %>%
select( -foto,
-nome,
-preco_num,
-variacao_num )
precos_jogadores <- dados_mercado$atletas[1:13] %>%
as_data_frame %>%
select( atleta_id,
apelido,
rodada_id,
status_id,
preco_num,
variacao_num )
precos_jogadores
label_posicoes <- dados_mercado$posicoes %>%
unlist() %>%
matrix(., 3, 6) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( posicao_id = X1,
posicao = X3 ) %>%
mutate( posicao_id = as.integer( posicao_id ) ) %>%
select( -X2 )
label_posicoes
label_status <- dados_mercado$status %>%
unlist() %>%
matrix(., 2, 5) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( status_id = X1,
status = X2 ) %>%
mutate( status_id = as.integer(status_id) )
label_status
label_clubes <- dados_mercado[2] %>%
unlist() %>%
matrix(., 8, 20) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( clube_id = X1,
clube = X2,
classificacao = X4) %>%
mutate( clube_id = as.integer(clube_id),
classificacao = as.integer(classificacao),
rodada_id = informacoes_jogadores$rodada_id[1] + 1 ) %>%
select( clube_id,
clube,
rodada_id,
classificacao )
label_clubes
scouts_jogadores <- dados_mercado$atletas$scout %>%
as_data_frame()
scouts_jogadores
informacoes_partidas <- dados_partidas[1] %>%
data.frame() %>%
select( -partidas.url_transmissao,
-partidas.url_confronto )
informacoes_partidas
dados_partidas_anterior[1]
classificacao <- label_clubes %>%
rename( clube_rank = classificacao ) %>%
mutate( ano = year( Sys.Date() ) )
classificacao
informacoes_partidas %<>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_visitante_id") ) %>%
rename(., partidas.clube_visitante_id = clube_id ) %>%
rename(., partidas.clube_visitante_nome = clube ) %>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_casa_id") ) %>%
rename(., partidas.clube_casa_id = clube_id ) %>%
rename(., partidas.clube_casa_nome = clube ) %>%
select( partidas.clube_casa_id,
partidas.clube_casa_nome,
partidas.clube_casa_posicao,
partidas.clube_visitante_id,
partidas.clube_visitante_nome,
partidas.clube_visitante_posicao,
partidas.partida_data,
partidas.local,
partidas.placar_oficial_mandante,
partidas.placar_oficial_visitante )
informacoes_partidas
partidas <- informacoes_partidas %>%
mutate( rodada_id = label_clubes$rodada_id[1] - 1,
ano = year( Sys.Date() ) ) %>%
select( rodada_id,
clube_casa_id = partidas.clube_casa_id,
clube_visitante_id = partidas.clube_visitante_id,
placar_oficial_mandante = partidas.placar_oficial_mandante,
placar_oficial_visitante = partidas.placar_oficial_visitante,
clube_casa = partidas.clube_casa_nome,
clube_visitante = partidas.clube_visitante_nome,
ano,
partidas.partida_data,
partidas.local)
partidas
informacoes_partidas_anterior
label_clubes %<>%
select( -rodada_id )
precos_jogadores %<>%
select( preco_num,
variacao_num,
preco_num_anterior )
precos_jogadores
informacoes_jogadores %<>%
right_join(., x = label_posicoes, by = "posicao_id" ) %>%
right_join(., x = label_status, by = "status_id" ) %>%
right_join(., x = label_clubes, by = "clube_id" ) %>%
bind_cols(., precos_jogadores ) %>%
bind_cols(., scouts_jogadores ) %>%
mutate( ano = year(Sys.Date()),
jogos_num = NA ) %>%
select( -classificacao, -slug ) %>%
as_data_frame()
informacoes_jogadores
informacoes_jogadores
informacoes_jogadores %>%
select( atleta_id, apelido, clube, status_id, status, posicao, preco_num )
informacoes_jogadores %>%
select( atleta_id, apelido, clube, status_id, status, posicao, preco_num ) %>%
filter( status_id == 7 )
ano = 2018
rod = 38
jogadores <- read_csv( paste0( 'historico/', ano, '/', 'scouts/', ano, '_scouts_', rod, '.csv' ) )
informacoes_jogadores
getwd()
setwd("/home/vm-data-science/projeto_cartola/dados")
jogadores <- read_csv( paste0( 'historico/', ano, '/', 'scouts/', ano, '_scouts_', rod, '.csv' ) )
jogadores
jogadores %>%
select( atleta_id, media_num, preco_num,  variacao_num )
dados_ultimo_ano <- jogadores %>%
select( atleta_id, media_num, preco_num,  variacao_num ) %>%
rename( preco_num_last = preco_num )
dados_atuais <- informacoes_jogadores %>%
select( atleta_id, apelido, clube, status_id, status, posicao, preco_num ) %>%
filter( status_id == 7 )
dados_ultimo_ano
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'ata' )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'ata' ) %>%
arrange( preco_num )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'ata' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'mei' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'mei' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'zag' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'lat' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'ata' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'mei' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'gol' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'mei' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
partidas %>%
select( clube_casa, clube_visitante )
dados_atuais %>%
left_join(., dados_ultimo_ano,
by = "atleta_id" ) %>%
filter( posicao == 'zag' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
library(ProjectTemplate)
setwd('atual/')
load.project()
info( logger, "CARTOLA_DADOS::iniciado" )
info( logger, "CARTOLA_DADOS::obtem dados do mercado" )
dados_mercado <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/atletas/mercado" ),
collapse = "" )
)
dados_partidas <- fromJSON(
paste(
readLines( "https://api.cartolafc.globo.com/partidas" ),
collapse = "" )
)
dados_partidas
info( logger, "CARTOLA_DADOS::obtem dados das partidas anteriores" )
rodada_anterior <- dados_partidas$rodada - 1
dados_partidas_anterior <- fromJSON(
paste(
readLines( paste0( "https://api.cartolafc.globo.com/partidas/", rodada_anterior ) ),
collapse = "" )
)
rm(rodada_anterior)
informacoes_jogadores <- dados_mercado$atletas[1:14] %>%
as_data_frame %>%
select( -foto,
-nome,
-preco_num,
-variacao_num )
informacoes_jogadores
precos_jogadores <- dados_mercado$atletas[1:13] %>%
as_data_frame %>%
select( atleta_id,
apelido,
rodada_id,
status_id,
preco_num,
variacao_num ) %>%
mutate( rodada_id = rodada_id + 1,
preco_num_anterior = preco_num - variacao_num )
precos_jogadores
label_posicoes <- dados_mercado$posicoes %>%
unlist() %>%
matrix(., 3, 6) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( posicao_id = X1,
posicao = X3 ) %>%
mutate( posicao_id = as.integer( posicao_id ) ) %>%
select( -X2 )
label_status <- dados_mercado$status %>%
unlist() %>%
matrix(., 2, 5) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( status_id = X1,
status = X2 ) %>%
mutate( status_id = as.integer(status_id) )
label_clubes <- dados_mercado[2] %>%
unlist() %>%
matrix(., 8, 20) %>%
t() %>%
data.frame(., stringsAsFactors = FALSE ) %>%
rename( clube_id = X1,
clube = X2,
classificacao = X4) %>%
mutate( clube_id = as.integer(clube_id),
classificacao = as.integer(classificacao),
rodada_id = informacoes_jogadores$rodada_id[1] ) %>%
select( clube_id,
clube,
rodada_id,
classificacao )
label_clubes
scouts_jogadores <- dados_mercado$atletas$scout %>%
as_data_frame()
scouts_jogadores
informacoes_partidas <- dados_partidas[1] %>%
data.frame() %>%
select( -partidas.url_transmissao,
-partidas.url_confronto )
informacoes_partidas
informacoes_partidas_anterior <- dados_partidas_anterior[1] %>%
data.frame() %>%
select( -partidas.url_transmissao,
-partidas.url_confronto )
rm(dados_partidas_anterior)
informacoes_partidas_anterior
classificacao <- label_clubes %>%
rename( clube_rank = classificacao ) %>%
mutate( ano = year( Sys.Date() ) )
classificacao
label_clubes$rodada_id[1]
write_csv( classificacao,
path = paste0( 'data/classificacao/', year( Sys.Date() ), '_classificacao_', label_clubes$rodada_id[1], '.csv' ) )
informacoes_partidas %<>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_visitante_id") ) %>%
rename(., partidas.clube_visitante_id = clube_id ) %>%
rename(., partidas.clube_visitante_nome = clube ) %>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_casa_id") ) %>%
rename(., partidas.clube_casa_id = clube_id ) %>%
rename(., partidas.clube_casa_nome = clube ) %>%
select( partidas.clube_casa_id,
partidas.clube_casa_nome,
partidas.clube_casa_posicao,
partidas.clube_visitante_id,
partidas.clube_visitante_nome,
partidas.clube_visitante_posicao,
partidas.partida_data,
partidas.local,
partidas.placar_oficial_mandante,
partidas.placar_oficial_visitante )
partidas <- informacoes_partidas %>%
mutate( rodada_id = label_clubes$rodada_id[1]+1,
ano = year( Sys.Date() ) ) %>%
select( rodada_id,
clube_casa_id = partidas.clube_casa_id,
clube_visitante_id = partidas.clube_visitante_id,
placar_oficial_mandante = partidas.placar_oficial_mandante,
placar_oficial_visitante = partidas.placar_oficial_visitante,
clube_casa = partidas.clube_casa_nome,
clube_visitante = partidas.clube_visitante_nome,
ano,
partidas.partida_data,
partidas.local)
partidas
informacoes_partidas_anterior %<>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_visitante_id") ) %>%
rename(., partidas.clube_visitante_id = clube_id ) %>%
rename(., partidas.clube_visitante_nome = clube ) %>%
right_join(., x = label_clubes, by = c("clube_id" = "partidas.clube_casa_id") ) %>%
rename(., partidas.clube_casa_id = clube_id ) %>%
rename(., partidas.clube_casa_nome = clube ) %>%
select( partidas.clube_casa_id,
partidas.clube_casa_nome,
partidas.clube_casa_posicao,
partidas.clube_visitante_id,
partidas.clube_visitante_nome,
partidas.clube_visitante_posicao,
partidas.partida_data,
partidas.local,
partidas.placar_oficial_mandante,
partidas.placar_oficial_visitante )
informacoes_partidas_anterior
partidas_anterior <- informacoes_partidas_anterior %>%
mutate( rodada_id = label_clubes$rodada_id[1],
ano = year( Sys.Date() ) ) %>%
select( rodada_id,
clube_casa_id = partidas.clube_casa_id,
clube_visitante_id = partidas.clube_visitante_id,
placar_oficial_mandante = partidas.placar_oficial_mandante,
placar_oficial_visitante = partidas.placar_oficial_visitante,
clube_casa = partidas.clube_casa_nome,
clube_visitante = partidas.clube_visitante_nome,
ano,
partidas.partida_data,
partidas.local)
partidas_anterior
write_csv( partidas_anterior,
path = paste0( 'data/partidas/', year( Sys.Date() ), '_partidas_', label_clubes$rodada_id[1], '.csv' ) )
label_clubes %<>%
select( -rodada_id )
precos_jogadores %<>%
select( preco_num,
variacao_num,
preco_num_anterior )
informacoes_jogadores %<>%
right_join(., x = label_posicoes, by = "posicao_id" ) %>%
right_join(., x = label_status, by = "status_id" ) %>%
right_join(., x = label_clubes, by = "clube_id" ) %>%
bind_cols(., precos_jogadores ) %>%
bind_cols(., scouts_jogadores ) %>%
mutate( ano = year(Sys.Date()) ) %>%
select( -classificacao, -slug ) %>%
as_data_frame()
informacoes_jogadores
informacoes_jogadores %>% data.frame %>% head()
informacoes_jogadores %>% data.frame %>% tail()
write_csv( informacoes_jogadores,
path = paste0( 'data/scouts/', year( Sys.Date() ), '_scouts_', informacoes_jogadores$rodada_id[1], '.csv' ) )
dados_atuais <- informacoes_jogadores %>%
select( atleta_id, apelido, clube, status_id, status, posicao, jogos_num, preco_num, pontos_num, media_num, variacao_num ) %>%
filter( status_id == 7 )
dados_atuais
m2 <- summary( lm( variacao_num ~ pontos_num + preco_num,
data = dados_atuais %>%
filter( jogos_num == 2 ) ) )
m2
dados_atuais %>%
filter( posicao == 'ata' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
filter( posicao == 'mei' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
filter( posicao == 'zag' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
filter( posicao == 'lat' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
filter( posicao == 'gol' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
dados_atuais %>%
filter( posicao == 'tec' ) %>%
arrange( preco_num ) %>%
print(n=Inf)
library(ProjectTemplate)
setwd('atual/')
load.project()
